webpackJsonp([0],{"3IrD":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("KTxs");function n(e,t){var i={};for(var s in t){var n=t[s],o=[];for(var a in n)o.push({type:e,name:s,key:a,img:n[a].img});o.length>0&&(i[s]={type:e,name:s,list:o,album:o[0].img})}return i}var o={props:{type:String,scene:String,to:String},data:function(){return{currType:"emoji",currAlbum:"emoji"}},computed:{emoji:function(){return n("emoji",s.a.emojiList)},pinup:function(){return n("pinup",s.a.pinupList)},currEmoji:function(){return"emoji"===this.currType?this.emoji[this.currAlbum]:"pinup"===this.currType?this.pinup[this.currAlbum]:[]}},methods:{selectAlbum:function(e){this.currType=e.type,this.currAlbum=e.name},selectEmoji:function(e){"emoji"===this.currType?this.$emit("add-emoji",e.key):"pinup"===this.currType&&("session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:e.key}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[贴图表情]",content:{type:3,data:{catalog:this.currAlbum,chartlet:e.key}}}),this.$emit("hide-emoji"))}}},a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"m-chat-emoji"},[i("div",{staticClass:"emoji-content"},[i("div",{staticClass:"cnt"},e._l(e.currEmoji.list,function(t){return i("span",{staticClass:"emoji-item",class:{"pinup-item":"pinup"===t.type},on:{click:function(i){i.stopPropagation(),e.selectEmoji(t)}}},[i("img",{attrs:{src:t.img}})])}),0)])])},staticRenderFns:[]};var r=i("VU/8")(o,a,!1,function(e){i("ZUOX")},null,null).exports,m=i("e27e"),l=i("ynr7"),p={components:{ChatEmoji:r},updated:function(){var e=this;window.document.body.addEventListener("click",function(){e.isEmojiShown=!1})},props:{type:String,scene:String,to:String},data:function(){return{isEmojiShown:!1,msgToSent:"",icon1:l.a.resourceUrl+"/im/chat-editor-1.png",icon2:l.a.resourceUrl+"/im/chat-editor-2.png",icon3:l.a.resourceUrl+"/im/chat-editor-3.png"}},methods:{sendTextMsg:function(){/^\s*$/.test(this.msgToSent)?this.$vux.alert.show({title:"请不要刷屏"}):this.msgToSent.length>800?this.$vux.alert.show({title:"请不要超过800个字"}):("session"===this.type?this.$store.dispatch("sendMsg",{type:"text",scene:this.scene,to:this.to,text:this.msgToSent}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"text",text:this.msgToSent}),this.msgToSent="")},sendPlayMsg:function(){"session"===this.type?this.$store.dispatch("sendMsg",{type:"custom",scene:this.scene,to:this.to,pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomMsg",{type:"custom",pushContent:"[猜拳]",content:{type:1,data:{value:Math.ceil(3*Math.random())}}})},sendFileMsg:function(){var e=this.$refs.fileToSent;e.value&&("session"===this.type?this.$store.dispatch("sendFileMsg",{scene:this.scene,to:this.to,fileInput:e}):"chatroom"===this.type&&this.$store.dispatch("sendChatroomFileMsg",{fileInput:e}))},showEmoji:function(){this.isEmojiShown=!0},hideEmoji:function(){this.isEmojiShown=!1},addEmoji:function(e){this.msgToSent+=e,this.hideEmoji()}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"m-chat-editor"},[i("chat-emoji",{directives:[{name:"show",rawName:"v-show",value:e.isEmojiShown,expression:"isEmojiShown"}],attrs:{type:e.type,scene:e.scene,to:e.to},on:{"add-emoji":e.addEmoji,"hide-emoji":e.hideEmoji}}),e._v(" "),i("div",{staticClass:"m-chat-editor-main"},[i("span",{staticClass:"u-editor-input"},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msgToSent,expression:"msgToSent"}],attrs:{placeholder:"请输入您的问题……"},domProps:{value:e.msgToSent},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.sendTextMsg(t):null},input:function(t){t.target.composing||(e.msgToSent=t.target.value)}}})]),e._v(" "),i("div",{staticClass:"u-editor-icons"},[i("span",{staticClass:"u-editor-icon",on:{click:function(t){return t.stopPropagation(),e.showEmoji(t)}}},[i("i",{staticClass:"u-icon-img"},[i("img",{attrs:{src:e.icon1}})])]),e._v(" "),"session"===e.type?i("span",{staticClass:"u-editor-icon",on:{change:e.sendFileMsg}},[i("i",{staticClass:"u-icon-img"},[i("img",{attrs:{src:e.icon2}})]),e._v(" "),i("input",{ref:"fileToSent",attrs:{type:"file"}})]):e._e(),e._v(" "),i("span",{staticClass:"u-editor-send",on:{click:e.sendTextMsg}},[e._v("发送")])])])],1)},staticRenderFns:[]},f=i("VU/8")(p,c,!1,null,null,null).exports,u=i("NufB"),g=i("XEb1"),h=i("Fd2+"),d=i("4GAc"),j={components:{ChatEditor:f,ChatList:u.a},data:function(){return{leftBtnOptions:{backText:" ",preventGoBack:!0}}},watch:{$route:function(e,t){},sessionId:function(e){this.$store.dispatch("setCurrSession",e)}},mounted:function(){var e=this;this.$store.dispatch("showLoading"),null==d.a.readCookie("uid")&&(Object(h.d)("token错误~，请重新登录··"),setTimeout(function(){e.$router.push("/login")},300)),this.$store.dispatch("setCurrSession",this.sessionId),g.a.scrollChatListDown(),setTimeout(function(){e.$store.dispatch("hideLoading")},1e3)},updated:function(){g.a.scrollChatListDown()},destroyed:function(){this.$store.dispatch("resetCurrSession")},computed:{sessionId:function(){var e=this.$route.params.sessionId;return e},sessionName:function(){var e=this.sessionId,t=null;if(/^p2p-/.test(e)){if((t=e.replace(/^p2p-/,""))===this.$store.state.userUID)return"我的手机";var i=this.userInfos[t]||{};return m.a.getFriendAlias(i)}if(/^team-/.test(e))return"群"},scene:function(){return m.a.parseSession(this.sessionId).scene},to:function(){return m.a.parseSession(this.sessionId).to},myInfo:function(){return this.$store.state.myInfo},userInfos:function(){return this.$store.state.userInfos},msglist:function(){return this.$store.state.currSessionMsgs}},methods:{enterHistory:function(){this.$router.push({path:"/chatHistory/"+this.sessionId})},onClickBack:function(){this.$store.state.sessionlist=[],this.$router.back(-1)},msgsLoaded:function(){g.a.scrollChatListDown()},enterNameCard:function(){if(/^p2p-/.test(this.sessionId)){var e=this.sessionId.replace(/^p2p-/,"");if(e===this.$store.state.userUID)return void this.$router.push({path:"/im_web/general"});this.$router.push({path:"/im_web/namecard/"+e})}},enterTeamInfo:function(){var e=this.sessionId.replace(/^team-/,"");this.$router.push({path:"/im_web/teamInfo/"+e})}}},_={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"initdiv"},[i("div",{staticClass:"g-window"},[i("van-nav-bar",{staticClass:"init-header",attrs:{title:"客服","right-text":"历史消息","left-arrow":""},on:{"click-left":e.onClickBack,"click-right":e.enterHistory}}),e._v(" "),i("div",{staticClass:"g-inherit m-article"},[i("div",{staticClass:"m-chat-main",attrs:{id:"m-chat-main"}},[i("chat-list",{attrs:{type:"session",msglist:e.msglist,userInfos:e.userInfos,myInfo:e.myInfo},on:{"msgs-loaded":e.msgsLoaded}})],1),e._v(" "),i("chat-editor",{staticStyle:{position:"absolute",bottom:"0px"},attrs:{type:"session",scene:e.scene,to:e.to}})],1)],1)])},staticRenderFns:[]};var y=i("VU/8")(j,_,!1,function(e){i("IfyI"),i("FJY9")},null,null);t.default=y.exports},FJY9:function(e,t){},IfyI:function(e,t){},KTxs:function(e,t,i){"use strict";i("ynr7");var s="http://yx-web.nosdn.127.net/webdoc/h5/emoji",n={emoji:{"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[汗]":{file:"emoji_145.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"},"[雷]":{file:"emoji_54.png"},"[雨]":{file:"emoji_55.png"},"[雪花]":{file:"emoji_56.png"},"[爱人]":{file:"emoji_57.png"},"[帽子]":{file:"emoji_58.png"},"[皇冠]":{file:"emoji_59.png"},"[篮球]":{file:"emoji_60.png"},"[足球]":{file:"emoji_61.png"},"[垒球]":{file:"emoji_62.png"},"[网球]":{file:"emoji_63.png"},"[台球]":{file:"emoji_64.png"},"[咖啡]":{file:"emoji_65.png"},"[啤酒]":{file:"emoji_66.png"},"[干杯]":{file:"emoji_67.png"},"[柠檬汁]":{file:"emoji_68.png"},"[餐具]":{file:"emoji_69.png"},"[汉堡]":{file:"emoji_70.png"},"[鸡腿]":{file:"emoji_71.png"},"[面条]":{file:"emoji_72.png"},"[冰淇淋]":{file:"emoji_73.png"},"[沙冰]":{file:"emoji_74.png"},"[生日蛋糕]":{file:"emoji_75.png"},"[蛋糕]":{file:"emoji_76.png"},"[糖果]":{file:"emoji_77.png"},"[葡萄]":{file:"emoji_78.png"},"[西瓜]":{file:"emoji_79.png"},"[光碟]":{file:"emoji_80.png"},"[手机]":{file:"emoji_81.png"},"[电话]":{file:"emoji_82.png"},"[电视]":{file:"emoji_83.png"},"[声音开启]":{file:"emoji_84.png"},"[声音关闭]":{file:"emoji_85.png"},"[铃铛]":{file:"emoji_86.png"},"[锁头]":{file:"emoji_87.png"},"[放大镜]":{file:"emoji_88.png"},"[灯泡]":{file:"emoji_89.png"},"[锤头]":{file:"emoji_90.png"},"[烟]":{file:"emoji_91.png"},"[炸弹]":{file:"emoji_92.png"},"[枪]":{file:"emoji_93.png"},"[刀]":{file:"emoji_94.png"},"[药]":{file:"emoji_95.png"},"[打针]":{file:"emoji_96.png"},"[钱袋]":{file:"emoji_97.png"},"[钞票]":{file:"emoji_98.png"},"[银行卡]":{file:"emoji_99.png"},"[手柄]":{file:"emoji_100.png"},"[麻将]":{file:"emoji_101.png"},"[调色板]":{file:"emoji_102.png"},"[电影]":{file:"emoji_103.png"},"[麦克风]":{file:"emoji_104.png"},"[耳机]":{file:"emoji_105.png"},"[音乐]":{file:"emoji_106.png"},"[吉他]":{file:"emoji_107.png"},"[火箭]":{file:"emoji_108.png"},"[飞机]":{file:"emoji_109.png"},"[火车]":{file:"emoji_110.png"},"[公交]":{file:"emoji_111.png"},"[轿车]":{file:"emoji_112.png"},"[出租车]":{file:"emoji_113.png"},"[警车]":{file:"emoji_114.png"},"[自行车]":{file:"emoji_115.png"}}};for(var o in n){var a=n[o];for(var r in a){var m=a[r];m.img=s+"/"+o+"/"+m.file}}for(var l={ajmd:{},xxy:{},lt:{}},p=1;p<=48;p++){var c="ajmd0"+(p>=10?p:"0"+p);l.ajmd[c]={file:c+".png"}}for(var f=1;f<=40;f++){var u="xxy0"+(f>=10?f:"0"+f);l.xxy[u]={file:u+".png"}}for(var g=1;g<=20;g++){var h="lt0"+(g>=10?g:"0"+g);l.lt[h]={file:h+".png"}}for(var d in l){var j=l[d];for(var _ in j){var y=j[_];y.img=s+"/"+d+"/"+y.file}}t.a={emojiList:n,pinupList:l}},NufB:function(e,t,i){"use strict";var s=i("e27e"),n=i("ynr7"),o=i("KTxs"),a=i("woOf"),r=i.n(a),m={props:{type:String,rawMsg:{type:Object,default:function(){return{}}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}}},data:function(){return{msg:"",isFullImgShow:!1,currentAudio:null}},beforeMount:function(){var e=r()({},this.rawMsg);if("session"===this.type?"in"===e.flow?(e.from!==this.$store.state.userUID?e.avatar=this.userInfos[e.from].avatar:e.avatar=this.myInfo.avatar,e.link="#/im_web/namecard/"+e.from):"out"===e.flow&&(e.avatar=this.myInfo.avatar):e.showTime=s.a.formatDate(e.time),"timeTag"===e.type)e.showText=e.text;else if("text"===e.type){if(e.showText=s.a.escape(e.text),/\[[^\]]+\]/.test(e.showText))e.showText.match(/\[[^\]]+\]/g).forEach(function(t){var i=o.a.emojiList.emoji;i[t]&&(e.showText=e.showText.replace(t,'<img class="emoji-small" src="'+i[t].img+'">'))})}else if("custom"===e.type){var t=JSON.parse(e.content);if(1===t.type){var i=t.data,a=n.a.resourceUrl;e.type="custom-type1",e.imgUrl=a+"/im/play-"+i.value+".png"}else if(3===t.type){var m=t.data,l="";o.a.pinupList[m.catalog]&&(l=o.a.pinupList[m.catalog][m.chartlet],e.type="custom-type3",e.imgUrl=""+l.img)}else e.showText=s.a.parseCustomMsg(e),"[自定义消息]"!==e.showText&&(e.showText+=",请到手机或电脑客户端查看")}else"image"===e.type?e.originLink=e.file.url:"video"===e.type||("audio"===e.type?(e.audioSrc=e.file.mp3Url,e.showText=Math.round(e.file.dur/1e3)+'" 点击播放'):"file"===e.type?(e.fileLink=e.file.url,e.showText=e.file.name):"notification"===e.type?e.showText=s.a.generateChatroomSysMsg(e):"tip"===e.type?e.showText=e.tip:e.showText="["+s.a.mapMsgType(e)+"],请到手机或电脑客户端查看");this.msg=e},mounted:function(){var e=this,t=this.msg;this.$nextTick(function(){var i=null;if("image"===t.type)(i=new Image).src=t.file.url+"?imageView&thumbnail=180x0&quality=85";else if("custom-type1"===t.type)(i=new Image).className="emoji-middle",i.src=t.imgUrl;else if("custom-type3"===t.type)(i=new Image).className="emoji-big",i.src=t.imgUrl;else if("video"===t.type)if(/(mov|mp4|ogg|webm)/i.test(t.file.ext))(i=document.createElement("video")).src=t.file.url,i.width=640,i.height=480,i.autoStart=!1,i.preload="metadata",i.controls="controls";else{var s=document.createElement("a");s.href=t.file.url,s.target="_blank",s.innerHTML='<i class="u-icon icon-file"></i>'+video.name,e.$refs.mediaMsg.appendChild(s)}i?(e.$refs.mediaMsg&&e.$refs.mediaMsg.appendChild(i),i.onload=function(){e.$emit("msg-loaded")},i.onerror=function(){e.$emit("msg-loaded")}):e.$emit("msg-loaded")})},methods:{revocateMsg:function(e){if(this.$store.state.currSessionId&&e&&e.data&&e.data.attrs){var t=e.data.attrs;if("out"===t.flow){var i=this;this.$vux.confirm.show({title:"确定需要撤回消息",onCancel:function(){},onConfirm:function(){i.$store.dispatch("revocateMsg",{idClient:t.idClient})}})}}},showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},playAudio:function(e){var t=this;this.currentAudio||(this.currentAudio=new Audio(e),this.currentAudio.play(),this.currentAudio.onended=function(){t.currentAudio=null})}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("li",{staticClass:"u-msg",class:{"item-me":"out"===e.msg.flow,"item-you":"in"===e.msg.flow,"item-time":"timeTag"===e.msg.type,"item-tip":"tip"===e.msg.type,"session-chat":"session"===e.type}},["timeTag"===e.msg.type?i("div",[e._v("---- "+e._s(e.msg.showText)+" ----")]):"tip"===e.msg.type?i("div",{staticClass:"tip"},[e._v(e._s(e.msg.showText))]):"in"===e.msg.flow||"out"===e.msg.flow?i("div",{attrs:{idClient:e.msg.idClient,time:e.msg.time,flow:e.msg.flow}},[e.msg.avatar?i("a",{staticClass:"msg-head",attrs:{href:e.msg.link}},[i("img",{attrs:{src:e.msg.avatar}})]):"notification"!==e.msg.type?i("p",{staticClass:"msg-user"},[i("em",[e._v(e._s(e.msg.showTime))]),e._v(e._s(e.msg.from))]):e._e(),e._v(" "),"text"===e.msg.type?i("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}):"custom-type1"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"custom-type3"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"image"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text",on:{click:function(t){t.stopPropagation(),e.showFullImg(e.msg.originLink)}}}):"video"===e.msg.type?i("span",{ref:"mediaMsg",staticClass:"msg-text"}):"audio"===e.msg.type?i("span",{staticClass:"msg-text",on:{click:function(t){e.playAudio(e.msg.audioSrc)}}},[e._v(e._s(e.msg.showText))]):"file"===e.msg.type?i("span",{staticClass:"msg-text"},[i("a",{attrs:{href:e.msg.fileLink,target:"_blank"}},[i("i",{staticClass:"u-icon icon-file"}),e._v(e._s(e.msg.showText))])]):"notification"===e.msg.type?i("span",{staticClass:"msg-text notify"},[e._v(e._s(e.msg.showText))]):i("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}),e._v(" "),"fail"===e.msg.status?i("span",{staticClass:"msg-failed"},[i("i",{staticClass:"weui-icon-warn"})]):e._e()]):e._e()])},staticRenderFns:[]},p={components:{ChatItem:i("VU/8")(m,l,!1,null,null,null).exports},props:{type:String,canLoadMore:[String,Boolean],msglist:{type:Array,default:function(){return[]}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}}},data:function(){return{isFullImgShow:!1,msgLoadedTimer:null}},methods:{showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},msgLoaded:function(){var e=this;clearTimeout(this.msgLoadedTimer),this.msgLoadedTimer=setTimeout(function(){e.$emit("msgs-loaded")},20)}}},c={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("ul",{staticClass:"m-chat-list p-chat-list",staticStyle:{"padding-bottom":"40px","margin-top":"40px"},attrs:{id:"chat-list"}},[(e.canLoadMore,i("li",{staticClass:"u-msg item-time"})),e._v(" "),e._l(e.msglist,function(t){return i("chat-item",{key:t.idClient,attrs:{type:e.type,rawMsg:t,userInfos:e.userInfos,myInfo:e.myInfo},on:{"msg-loaded":e.msgLoaded}})})],2)},staticRenderFns:[]};var f=i("VU/8")(p,c,!1,function(e){i("vPY7")},null,null);t.a=f.exports},ZUOX:function(e,t){},vPY7:function(e,t){}});
//# sourceMappingURL=0.69fec1bd943c50eaf990.js.map
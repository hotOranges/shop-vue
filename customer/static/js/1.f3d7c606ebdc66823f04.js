webpackJsonp([1],{"/2mR":function(e,i,t){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=t("NufB"),n=t("e27e"),o=t("XEb1"),a={mounted:function(){this.$store.dispatch("resetNoMoreHistoryMsgs"),this.getHistoryMsgs()},updated:function(){var e=o.a.getChatListHeight();o.a.scrollChatListDown(e-this.currPagePos),this.currPagePos=e},components:{ChatList:s.a},data:function(){return{leftBtnOptions:{backText:" ",preventGoBack:!0},currPagePos:0}},computed:{sessionId:function(){return this.$route.params.sessionId},sessionName:function(){var e=this.sessionId,i=null;if(/^p2p-/.test(e)){if((i=e.replace(/^p2p-/,""))===this.$store.state.userUID)return"我的手机";var t=this.userInfos[i]||{};return n.a.getFriendAlias(t)}if(/^team-/.test(e))return"群"},myInfo:function(){return this.$store.state.myInfo},userInfos:function(){return this.$store.state.userInfos},msglist:function(){return this.$store.state.currSessionMsgs},scene:function(){return n.a.parseSession(this.sessionId).scene},to:function(){return n.a.parseSession(this.sessionId).to},canLoadMore:function(){return!this.$store.state.noMoreHistoryMsgs}},methods:{getHistoryMsgs:function(){this.canLoadMore&&this.$store.dispatch("getHistoryMsgs",{scene:this.scene,to:this.to})},loadMore:function(){o.a.getChatListScroll()<=5&&this.getHistoryMsgs()},onClickBack:function(){window.history.go(-1)}}},m={render:function(){var e=this.$createElement,i=this._self._c||e;return i("div",{staticClass:"g-window"},[i("van-nav-bar",{staticClass:"init-header",attrs:{title:"历史消息","left-arrow":""},on:{"click-left":this.onClickBack}}),this._v(" "),i("div",{staticClass:"g-inherit m-article p-chat-history"},[i("div",{staticClass:"m-chat-main init",staticStyle:{height:"700px"}},[i("chat-list",{ref:"chatlist",staticStyle:{height:"700px"},attrs:{type:"session",canLoadMore:this.canLoadMore,msglist:this.msglist,userInfos:this.userInfos,myInfo:this.myInfo}})],1)])],1)},staticRenderFns:[]};var l=t("VU/8")(a,m,!1,function(e){t("7m7h")},null,null);i.default=l.exports},"7m7h":function(e,i){},KTxs:function(e,i,t){"use strict";t("ynr7");var s="http://yx-web.nosdn.127.net/webdoc/h5/emoji",n={emoji:{"[大笑]":{file:"emoji_0.png"},"[可爱]":{file:"emoji_01.png"},"[色]":{file:"emoji_02.png"},"[嘘]":{file:"emoji_03.png"},"[亲]":{file:"emoji_04.png"},"[呆]":{file:"emoji_05.png"},"[口水]":{file:"emoji_06.png"},"[汗]":{file:"emoji_145.png"},"[呲牙]":{file:"emoji_07.png"},"[鬼脸]":{file:"emoji_08.png"},"[害羞]":{file:"emoji_09.png"},"[偷笑]":{file:"emoji_10.png"},"[调皮]":{file:"emoji_11.png"},"[可怜]":{file:"emoji_12.png"},"[敲]":{file:"emoji_13.png"},"[惊讶]":{file:"emoji_14.png"},"[流感]":{file:"emoji_15.png"},"[委屈]":{file:"emoji_16.png"},"[流泪]":{file:"emoji_17.png"},"[嚎哭]":{file:"emoji_18.png"},"[惊恐]":{file:"emoji_19.png"},"[怒]":{file:"emoji_20.png"},"[酷]":{file:"emoji_21.png"},"[不说]":{file:"emoji_22.png"},"[鄙视]":{file:"emoji_23.png"},"[阿弥陀佛]":{file:"emoji_24.png"},"[奸笑]":{file:"emoji_25.png"},"[睡着]":{file:"emoji_26.png"},"[口罩]":{file:"emoji_27.png"},"[努力]":{file:"emoji_28.png"},"[抠鼻孔]":{file:"emoji_29.png"},"[疑问]":{file:"emoji_30.png"},"[怒骂]":{file:"emoji_31.png"},"[晕]":{file:"emoji_32.png"},"[呕吐]":{file:"emoji_33.png"},"[拜一拜]":{file:"emoji_160.png"},"[惊喜]":{file:"emoji_161.png"},"[流汗]":{file:"emoji_162.png"},"[卖萌]":{file:"emoji_163.png"},"[默契眨眼]":{file:"emoji_164.png"},"[烧香拜佛]":{file:"emoji_165.png"},"[晚安]":{file:"emoji_166.png"},"[强]":{file:"emoji_34.png"},"[弱]":{file:"emoji_35.png"},"[OK]":{file:"emoji_36.png"},"[拳头]":{file:"emoji_37.png"},"[胜利]":{file:"emoji_38.png"},"[鼓掌]":{file:"emoji_39.png"},"[握手]":{file:"emoji_200.png"},"[发怒]":{file:"emoji_40.png"},"[骷髅]":{file:"emoji_41.png"},"[便便]":{file:"emoji_42.png"},"[火]":{file:"emoji_43.png"},"[溜]":{file:"emoji_44.png"},"[爱心]":{file:"emoji_45.png"},"[心碎]":{file:"emoji_46.png"},"[钟情]":{file:"emoji_47.png"},"[唇]":{file:"emoji_48.png"},"[戒指]":{file:"emoji_49.png"},"[钻石]":{file:"emoji_50.png"},"[太阳]":{file:"emoji_51.png"},"[有时晴]":{file:"emoji_52.png"},"[多云]":{file:"emoji_53.png"},"[雷]":{file:"emoji_54.png"},"[雨]":{file:"emoji_55.png"},"[雪花]":{file:"emoji_56.png"},"[爱人]":{file:"emoji_57.png"},"[帽子]":{file:"emoji_58.png"},"[皇冠]":{file:"emoji_59.png"},"[篮球]":{file:"emoji_60.png"},"[足球]":{file:"emoji_61.png"},"[垒球]":{file:"emoji_62.png"},"[网球]":{file:"emoji_63.png"},"[台球]":{file:"emoji_64.png"},"[咖啡]":{file:"emoji_65.png"},"[啤酒]":{file:"emoji_66.png"},"[干杯]":{file:"emoji_67.png"},"[柠檬汁]":{file:"emoji_68.png"},"[餐具]":{file:"emoji_69.png"},"[汉堡]":{file:"emoji_70.png"},"[鸡腿]":{file:"emoji_71.png"},"[面条]":{file:"emoji_72.png"},"[冰淇淋]":{file:"emoji_73.png"},"[沙冰]":{file:"emoji_74.png"},"[生日蛋糕]":{file:"emoji_75.png"},"[蛋糕]":{file:"emoji_76.png"},"[糖果]":{file:"emoji_77.png"},"[葡萄]":{file:"emoji_78.png"},"[西瓜]":{file:"emoji_79.png"},"[光碟]":{file:"emoji_80.png"},"[手机]":{file:"emoji_81.png"},"[电话]":{file:"emoji_82.png"},"[电视]":{file:"emoji_83.png"},"[声音开启]":{file:"emoji_84.png"},"[声音关闭]":{file:"emoji_85.png"},"[铃铛]":{file:"emoji_86.png"},"[锁头]":{file:"emoji_87.png"},"[放大镜]":{file:"emoji_88.png"},"[灯泡]":{file:"emoji_89.png"},"[锤头]":{file:"emoji_90.png"},"[烟]":{file:"emoji_91.png"},"[炸弹]":{file:"emoji_92.png"},"[枪]":{file:"emoji_93.png"},"[刀]":{file:"emoji_94.png"},"[药]":{file:"emoji_95.png"},"[打针]":{file:"emoji_96.png"},"[钱袋]":{file:"emoji_97.png"},"[钞票]":{file:"emoji_98.png"},"[银行卡]":{file:"emoji_99.png"},"[手柄]":{file:"emoji_100.png"},"[麻将]":{file:"emoji_101.png"},"[调色板]":{file:"emoji_102.png"},"[电影]":{file:"emoji_103.png"},"[麦克风]":{file:"emoji_104.png"},"[耳机]":{file:"emoji_105.png"},"[音乐]":{file:"emoji_106.png"},"[吉他]":{file:"emoji_107.png"},"[火箭]":{file:"emoji_108.png"},"[飞机]":{file:"emoji_109.png"},"[火车]":{file:"emoji_110.png"},"[公交]":{file:"emoji_111.png"},"[轿车]":{file:"emoji_112.png"},"[出租车]":{file:"emoji_113.png"},"[警车]":{file:"emoji_114.png"},"[自行车]":{file:"emoji_115.png"}}};for(var o in n){var a=n[o];for(var m in a){var l=a[m];l.img=s+"/"+o+"/"+l.file}}for(var r={ajmd:{},xxy:{},lt:{}},f=1;f<=48;f++){var g="ajmd0"+(f>=10?f:"0"+f);r.ajmd[g]={file:g+".png"}}for(var p=1;p<=40;p++){var c="xxy0"+(p>=10?p:"0"+p);r.xxy[c]={file:c+".png"}}for(var u=1;u<=20;u++){var _="lt0"+(u>=10?u:"0"+u);r.lt[_]={file:_+".png"}}for(var j in r){var d=r[j];for(var h in d){var y=d[h];y.img=s+"/"+j+"/"+y.file}}i.a={emojiList:n,pinupList:r}},NufB:function(e,i,t){"use strict";var s=t("e27e"),n=t("ynr7"),o=t("KTxs"),a=t("woOf"),m=t.n(a),l={props:{type:String,rawMsg:{type:Object,default:function(){return{}}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}}},data:function(){return{msg:"",isFullImgShow:!1,currentAudio:null}},beforeMount:function(){var e=m()({},this.rawMsg);if("session"===this.type?"in"===e.flow?(e.from!==this.$store.state.userUID?e.avatar=this.userInfos[e.from].avatar:e.avatar=this.myInfo.avatar,e.link="#/im_web/namecard/"+e.from):"out"===e.flow&&(e.avatar=this.myInfo.avatar):e.showTime=s.a.formatDate(e.time),"timeTag"===e.type)e.showText=e.text;else if("text"===e.type){if(e.showText=s.a.escape(e.text),/\[[^\]]+\]/.test(e.showText))e.showText.match(/\[[^\]]+\]/g).forEach(function(i){var t=o.a.emojiList.emoji;t[i]&&(e.showText=e.showText.replace(i,'<img class="emoji-small" src="'+t[i].img+'">'))})}else if("custom"===e.type){var i=JSON.parse(e.content);if(1===i.type){var t=i.data,a=n.a.resourceUrl;e.type="custom-type1",e.imgUrl=a+"/im/play-"+t.value+".png"}else if(3===i.type){var l=i.data,r="";o.a.pinupList[l.catalog]&&(r=o.a.pinupList[l.catalog][l.chartlet],e.type="custom-type3",e.imgUrl=""+r.img)}else e.showText=s.a.parseCustomMsg(e),"[自定义消息]"!==e.showText&&(e.showText+=",请到手机或电脑客户端查看")}else"image"===e.type?e.originLink=e.file.url:"video"===e.type||("audio"===e.type?(e.audioSrc=e.file.mp3Url,e.showText=Math.round(e.file.dur/1e3)+'" 点击播放'):"file"===e.type?(e.fileLink=e.file.url,e.showText=e.file.name):"notification"===e.type?e.showText=s.a.generateChatroomSysMsg(e):"tip"===e.type?e.showText=e.tip:e.showText="["+s.a.mapMsgType(e)+"],请到手机或电脑客户端查看");this.msg=e},mounted:function(){var e=this,i=this.msg;this.$nextTick(function(){var t=null;if("image"===i.type)(t=new Image).src=i.file.url+"?imageView&thumbnail=180x0&quality=85";else if("custom-type1"===i.type)(t=new Image).className="emoji-middle",t.src=i.imgUrl;else if("custom-type3"===i.type)(t=new Image).className="emoji-big",t.src=i.imgUrl;else if("video"===i.type)if(/(mov|mp4|ogg|webm)/i.test(i.file.ext))(t=document.createElement("video")).src=i.file.url,t.width=640,t.height=480,t.autoStart=!1,t.preload="metadata",t.controls="controls";else{var s=document.createElement("a");s.href=i.file.url,s.target="_blank",s.innerHTML='<i class="u-icon icon-file"></i>'+video.name,e.$refs.mediaMsg.appendChild(s)}t?(e.$refs.mediaMsg&&e.$refs.mediaMsg.appendChild(t),t.onload=function(){e.$emit("msg-loaded")},t.onerror=function(){e.$emit("msg-loaded")}):e.$emit("msg-loaded")})},methods:{revocateMsg:function(e){if(this.$store.state.currSessionId&&e&&e.data&&e.data.attrs){var i=e.data.attrs;if("out"===i.flow){var t=this;this.$vux.confirm.show({title:"确定需要撤回消息",onCancel:function(){},onConfirm:function(){t.$store.dispatch("revocateMsg",{idClient:i.idClient})}})}}},showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},playAudio:function(e){var i=this;this.currentAudio||(this.currentAudio=new Audio(e),this.currentAudio.play(),this.currentAudio.onended=function(){i.currentAudio=null})}}},r={render:function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("li",{staticClass:"u-msg",class:{"item-me":"out"===e.msg.flow,"item-you":"in"===e.msg.flow,"item-time":"timeTag"===e.msg.type,"item-tip":"tip"===e.msg.type,"session-chat":"session"===e.type}},["timeTag"===e.msg.type?t("div",[e._v("---- "+e._s(e.msg.showText)+" ----")]):"tip"===e.msg.type?t("div",{staticClass:"tip"},[e._v(e._s(e.msg.showText))]):"in"===e.msg.flow||"out"===e.msg.flow?t("div",{attrs:{idClient:e.msg.idClient,time:e.msg.time,flow:e.msg.flow}},[e.msg.avatar?t("a",{staticClass:"msg-head",attrs:{href:e.msg.link}},[t("img",{attrs:{src:e.msg.avatar}})]):"notification"!==e.msg.type?t("p",{staticClass:"msg-user"},[t("em",[e._v(e._s(e.msg.showTime))]),e._v(e._s(e.msg.from))]):e._e(),e._v(" "),"text"===e.msg.type?t("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}):"custom-type1"===e.msg.type?t("span",{ref:"mediaMsg",staticClass:"msg-text"}):"custom-type3"===e.msg.type?t("span",{ref:"mediaMsg",staticClass:"msg-text"}):"image"===e.msg.type?t("span",{ref:"mediaMsg",staticClass:"msg-text",on:{click:function(i){i.stopPropagation(),e.showFullImg(e.msg.originLink)}}}):"video"===e.msg.type?t("span",{ref:"mediaMsg",staticClass:"msg-text"}):"audio"===e.msg.type?t("span",{staticClass:"msg-text",on:{click:function(i){e.playAudio(e.msg.audioSrc)}}},[e._v(e._s(e.msg.showText))]):"file"===e.msg.type?t("span",{staticClass:"msg-text"},[t("a",{attrs:{href:e.msg.fileLink,target:"_blank"}},[t("i",{staticClass:"u-icon icon-file"}),e._v(e._s(e.msg.showText))])]):"notification"===e.msg.type?t("span",{staticClass:"msg-text notify"},[e._v(e._s(e.msg.showText))]):t("span",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.msg.showText)}}),e._v(" "),"fail"===e.msg.status?t("span",{staticClass:"msg-failed"},[t("i",{staticClass:"weui-icon-warn"})]):e._e()]):e._e()])},staticRenderFns:[]},f={components:{ChatItem:t("VU/8")(l,r,!1,null,null,null).exports},props:{type:String,canLoadMore:[String,Boolean],msglist:{type:Array,default:function(){return[]}},userInfos:{type:Object,default:function(){return{}}},myInfo:{type:Object,default:function(){return{}}}},data:function(){return{isFullImgShow:!1,msgLoadedTimer:null}},methods:{showFullImg:function(e){this.$store.dispatch("showFullscreenImg",{src:e})},msgLoaded:function(){var e=this;clearTimeout(this.msgLoadedTimer),this.msgLoadedTimer=setTimeout(function(){e.$emit("msgs-loaded")},20)}}},g={render:function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("ul",{staticClass:"m-chat-list p-chat-list",staticStyle:{"padding-bottom":"40px","margin-top":"40px"},attrs:{id:"chat-list"}},[(e.canLoadMore,t("li",{staticClass:"u-msg item-time"})),e._v(" "),e._l(e.msglist,function(i){return t("chat-item",{key:i.idClient,attrs:{type:e.type,rawMsg:i,userInfos:e.userInfos,myInfo:e.myInfo},on:{"msg-loaded":e.msgLoaded}})})],2)},staticRenderFns:[]};var p=t("VU/8")(f,g,!1,function(e){t("vPY7")},null,null);i.a=p.exports},vPY7:function(e,i){}});
//# sourceMappingURL=1.f3d7c606ebdc66823f04.js.map